<style type="text/css">
    #myNavTabs li:hover {
        cursor: pointer;
    }
</style>
 <section class="content-header">
    <h1 lang="text:part_information"></h1>
    <ol class="breadcrumb">
        <li><a href="#" lang="text:device_manage"></a></li>
        <li id="backSiteList"><a href="#" lang="text:equipment_information"></a></li>
        <li class="active"  lang="text:part_information"></li>
      </ol>
    <!-- <ol class="breadcrumb" style="margin-right: 30px;cursor: pointer;">
        <span class="glyphicon glyphicon-backward text-light-blue" lang="title:siteList" ></span>
    </ol> -->
</section>
<section class="content" id="tcontent">
    <div class="nav-tabs-custom">

        <ul class="nav nav-tabs" role="tablist" id="myNavTabs">
        <li role="presentation" class="active" onclick="showTabContent(1)">
            <a role="tab" data-toggle="tab" lang="text:change"></a>
        </li>
        <li role="presentation" onclick="showTabContent(2)" >
            <a role="tab" lang="text:lubricate" data-toggle="tab" ></a>
        </li>
        <li role="presentation" onclick="showTabContent(3)" >
            <a role="tab" lang="text:service" data-toggle="tab" ></a>
        </li>
    </ul>
        <!-- Tab panes -->
        <div class="tab-content" style="padding-bottom: 0px;">
            <!--表格数据区-->
            <div class=" tab-pane row active">
                <div class="col-md-12">
                    <div class="box box-solid" style="margin-bottom: 0px;box-shadow: 0px 0px;">
                        <!--加载数据等待-->
                        <div class="overlay" style="display: none;" id="refresh">
                            <i class="fa icon-refresh icon-spin"></i>
                        </div>
                        <div class="box-body" data-permissionFilter="[201]">
                            <div style="overflow:auto;display:none" id="changeTable">
                              <table class="table table-bordered">
                                  <thead>
                                  <tr>
                                      <th lang="text:component_name">元件名</th>
                                      <th lang="text:serial_number"></th>
                                      <th lang="text:device_part_model">型号</th>
                                      <th lang="text:change_time_recently">最近更换日期</th>
                                      <th lang="text:replacement_cycle">更换周期(天)</th>
                                      <th lang="text:operating_personnel">通知人员</th>
                                      <th lang="text:replace_the_record"></th>
                                      <th lang="text:operate" class="text-center"></th>
                                  </tr>
                                  </thead>
                                  <tbody id="parts_modal">
                                  <!--动态添加数据-->

                                   </tbody>
                              </table>
                            </div>
                            <div style="overflow:auto;display:none;" id="lubricationTable">
                                <table class="table table-bordered table-hover">
                                    <thead>
                                    <tr>
                                      <th lang="text:component_name">元件名</th>
                                      <th lang="text:serial_number"></th>
                                      <th lang="text:device_part_model">型号</th>
                                      <th lang="text:lubrication_time_recently">最近更换日期</th>
                                      <th lang="text:lubrication_interval">更换周期(天)</th>
                                      <th lang="text:operating_personnel">通知人员</th>
                                      <th lang="text:lubrication_record"></th>
                                      <th lang="text:operate" class="text-center"></th>
                                    </tr>
                                    </thead>
                                    <tbody id="logContent">

                                    <!--动态载入数据-->

                                    </tbody>
                                </table>
                            </div>
                            <div style="overflow:auto;  display:none;" id="checkTablepart">
                                <table class="table table-bordered table-hover">
                                    <thead>
                                    <tr>
                                      <th lang="text:component_name">元件名</th>
                                      <th lang="text:serial_number"></th>
                                      <th lang="text:device_part_model">型号</th>
                                      <th lang="text:service_time_recently">最近更换日期</th>
                                      <th lang="text:service_period">更换周期(天)</th>
                                      <th lang="text:operating_personnel">通知人员</th>
                                      <th lang="text:service_record"></th>
                                      <th lang="text:operate" class="text-center"></th>
                                    </tr>
                                    </thead>
                                    <tbody id="checkTable">

                                    <!--动态载入数据-->

                                    </tbody>
                                </table>
                            </div>
                        </div><!--box-body-->
                        <div id="page-footer">


                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<!--更换弹出框 -->
<div class="modal fade bs-example-modal-lg" id="changeModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:700px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" lang="text:replacement_parts_information">元器件信息(<span id="myModalLabe_name"></span>)</h4>
            </div>
            <form class="form-horizontal" id="form_id">
              <div class="box-body">
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:component_name"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="component_name_ch" readOnly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:old_serial_number"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="serial_number_ch" readOnly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" >
                    <span lang="text:new_serial_number"></span ><span class="text-red">*</span>
                  </label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control validate[required,custom[giveName],minSize[0],maxSize[30],funcCall[cloudInput]]" id="serial_number1"  placeholder="">
                  </div>
                </div>
                  <div class="form-group">
                      <label  class="col-sm-3 control-label" >
                          <span lang="text:operating_personnel"></span ><span class="text-red">*</span>
                      </label>
                      <div class="col-sm-9">
                          <select class="form-control" id="inform_person" >

                          </select>
                      </div>
                  </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:device_part_model"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="type1" placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:price"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="price" placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:supplier"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="supplier" placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label" lang="text:factory_time"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="factory_time"  readonly="readonly"  placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:comment"></label>

                  <div class="col-sm-9">
                    <textarea rows="3" cols="20" id="dec_ch" style="width:500px;resize: Vertical;"></textarea>
                  </div>
                </div>
              </div>
              <!-- /.box-body -->
            </form>
            <input type="hidden" value="" id="tempMid_ch"/>
            <div class="modal-footer">
              <button type="button" data-dismiss="modal" class="btn btn-default pull-left" lang="text:close"></button>
              <button type="button" class="btn btn-primary"  id="changePartsID" onclick="moreInfoParts5();" lang="text:submit"></button>
            </div>
        </div>
    </div>
</div>
<!-- 润滑弹出框 -->
<div class="modal fade bs-example-modal-lg" id="lubricateModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:700px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" lang="text:lubrication_parts_information">元器件信息(<span></span>)</h4>
            </div>
            <form class="form-horizontal">
              <div class="box-body">
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:serial_number"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="serial_number_1"  readonly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:component_name"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="component_name" readonly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:device_part_model"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="type" readonly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                    <label  class="col-sm-3 control-label" >
                        <span lang="text:operating_personnel"></span ><span class="text-red">*</span>
                    </label>
                    <div class="col-sm-9">
                        <select class="form-control" id="inform_person_lub" >

                        </select>
                    </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:comment"></label>

                  <div class="col-sm-9">
                    <textarea rows="3" cols="20" id="dec" style="width:500px;resize: Vertical;"></textarea>
                  </div>
                </div>
              </div>
              <!-- /.box-body -->
            </form>
            <input type="hidden" value="" id="tempMid_m"/>
            <div class="modal-footer">
              <button type="button" data-dismiss="modal" class="btn btn-default pull-left" lang="text:close"></button>
              <button type="button" class="btn btn-primary" lang="text:submit" data-dismiss="modal" onclick="moreInfoParts2();"></button>
            </div>
        </div>
    </div>
</div>

<!-- 维护弹出框 -->
<div class="modal fade bs-example-modal-lg" id="serviceModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:700px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" lang="text:maintain_parts_information">元器件信息(<span></span>)</h4>
            </div>
            <form class="form-horizontal">
              <div class="box-body">
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:serial_number"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="serial_number_se" readonly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:component_name"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="component_name_se" readonly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:device_part_model"></label>

                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="type_se" readonly placeholder="">
                  </div>
                </div>
                <div class="form-group">
                    <label  class="col-sm-3 control-label" >
                        <span lang="text:operating_personnel"></span ><span class="text-red">*</span>
                    </label>
                    <div class="col-sm-9">
                        <select class="form-control" id="inform_person_check" >

                        </select>
                    </div>
                </div>
                <div class="form-group">
                  <label  class="col-sm-3 control-label" lang="text:comment"></label>

                  <div class="col-sm-9">
                    <textarea rows="3" cols="20" id="dec1" style="width:500px;resize: Vertical;"></textarea>
                  </div>
                </div>
              </div>
              <!-- /.box-body -->
            </form>
            <input type="hidden" value="" id="tempMid_de"/>
            <div class="modal-footer">
              <button type="button" data-dismiss="modal" class="btn btn-default pull-left" lang="text:close"></button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" lang="text:submit" onclick="moreInfoParts4();"></button>
            </div>
        </div>
    </div>
</div>
<!-- 更换记录 -->
<div class="modal fade bs-example-modal-lg" id="changeListModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:915px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" lang="text:history">元器件信息(<span></span>)</h4>
            </div>
            <form class="form-horizontal">
              <div class="box-body">
                  <div style="overflow:auto;display:none;" id="ch_list">
                      <table class="table table-bordered table-striped">
                        <thead>
                        <tr>
                            <th lang="text:device_name" style="width:107px;"></th>
                            <th lang="text:component_name" style="width:140px;"></th>
                            <th lang="text:serial_number" style="width:113px;"></th>
                            <th lang="text:device_part_model" style="width:58px;"></th>
                            <th lang="text:change_time" style="width:149px;"></th>
                            <th lang="text:operating_personnel" style="width:125px;"></th>
                            <th lang="text:comment"></th>
                            <th lang="text:operate" class="text-center"style="width:51px;"></th>
                        </tr>
                        </thead>
                        <tbody id="parts_modal_list">
                        <!--动态添加数据-->

                         </tbody>
                    </table>
                </div>
                <div style="overflow:auto;display:none;" id="lub_list">
                  <table class="table table-bordered table-hover table-striped" >
                      <thead>
                      <tr>
                        <th lang="text:device_name" style="width:107px;"></th>
                        <th lang="text:component_name" style="width:140px;"></th>
                        <th lang="text:serial_number" style="width:113px;"></th>
                        <th lang="text:device_part_model" style="width:58px;"></th>
                        <th lang="text:lubrication_time" style="width:149px;"></th>
                        <th lang="text:operating_personnel" style="width:125px;"></th>
                        <th lang="text:comment"></th>
                      </tr>
                      </thead>
                      <tbody id="logContent_lub">

                      <!--动态载入数据-->

                      </tbody>
                  </table>
                </div>
                <div style="overflow:auto;display:none;" id="ser_list">
                  <table class="table table-bordered table-hover table-striped">
                      <thead>
                      <tr>
                        <th lang="text:device_name" style="width:107px;"></th>
                        <th lang="text:component_name" style="width:140px;"></th>
                        <th lang="text:serial_number" style="width:120px;"></th>
                        <th lang="text:device_part_model" style="width:82px;"></th>
                        <th lang="text:servicing_time" style="width:142px;"></th>
                        <th lang="text:operating_personnel"style="width:121px;"></th>
                        <th lang="text:comment"></th>
                      </tr>
                      </thead>
                      <tbody id="service_list">

                      <!--动态载入数据-->

                      </tbody>
                  </table>
                </div>
             </div>
              <!-- /.box-body -->
            </form>
            <input type="hidden" value="" id="changeListval"/>
            <div  id="page-footer_list">

            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var pickerOption = {
        language: locale.current() == 1 ? 'en' : 'zh-CN',
        autoclose: true, //选中之后自动隐藏日期选择框
        todayHighlight: false,
        format: 'yyyy-mm-dd',
        startView: 0, //起始选择范围，0为日，1为月，2为年
        minViewMode: 0 //最小选择范围
    }
    //nav-tabs选择项切换
    function showTabContent(tabPage) {
        $("#pageNumberSelect option").removeAttr("selected");
        $("#pageNumberSelect option:first").attr('selected',true);
        $("#panelContent").empty();
        $("#tableHead_checkbok").prop("checked", false);
        pageLoadCallback(0,tabPage);
    }
    $("#backSiteList").click(function(event) {
        $("#pcontent").load("admin/device_info.html",function (){
            set_$tcontentHeight();
        });
    });
    //  $('#inform_person').multiselect();
    (function($) {
        $.validationEngineLanguage = {
            "giveName": {
                "regex": /^[a-zA-Z0-9_\-\u4e00-\u9fa5]+$/i,
                "alertText": "* Invalid name"
            }
        }
    })(jQuery);
    //自定义外部函数
    function cloudInput(field, rules, i, options) {
        var nohtml = new RegExp("(<[^>]+>)|(&gt|&lt|&amp|&quot|&nbsp)");
        if (nohtml.test(field.val())) {
            //add rules at validationengine.lang
            return options.allrules.nohtml.alertText;
        }
        return true;
    }
    //分页回调方法
    function pageLoadCallback(index,tabPage){
        switch (tabPage) {
            case 1:
                changeTabOne(index, tabPage);
                break;
            case 2:
                changeTabTwo(index, tabPage);
                break;
            case 3:
                changeTabThree(index, tabPage);
                break;
            default:
                break;
        }
    }
    //第一个标签方法调用
    var tab=1;
     //获取所有维护人员信息
    function getMaintainer() {
        getAllMaintainer({"limit":0,"verbose":1}, function (data){
            if(data.result) {
                //回填维护人员信息
                var str = "";
                for(var i = 0; i < data.result.length; i++) {
                    str +="<option value='"+data.result[i].id+"' selected='selected'>"+data.result[i].name+"</option>";
                }
                $("#inform_person").append(str);
                $("#inform_person_lub").append(str);
                $("#inform_person_check").append(str);
            }
        },this);
    }
    //第一个tab页的调用
    function changeTabOne(cursor, tabPage) {
      $("#changeTable").show();
      $("#lubricationTable").hide();
      $("#checkTablepart").hide();
        //tabPage 第几个导航标签
        // cursor 表示从结果的第几条开始
        // limit  查询多少条
        $("#refresh").show();
        var limit = $("#pageNumberSelect").find("option:selected").val();
        tab=1;
        var params={
          cursor:cursor,
          limit:limit
        };
        $("#refresh").show();
        loadDevice_parts(deviceId,params,function(data){
            if(data.result && data.result.length>0){
                partsTable(data);
                renderPagination(data,changeTabOne);
            }else{
              clearPagination();
              $("#parts_modal").empty();
              $("#parts_modal").append('<tr><td colspan="8"  align="center" lang="text:no_data"></td></tr>');
            }
            $("#refresh").hide();
            locale.render({element: "#init_body"});
          },this)
        }
        //第二个标签方法调用
      function changeTabTwo(cursor, tabPage) {
        $("#changeTable").hide();
        $("#lubricationTable").show();
        $("#checkTablepart").hide();
        $("#refresh").show();
        var limit = $("#pageNumberSelect").find("option:selected").val();
        tab=2;
        var params={
          cursor:cursor,
          limit:limit
        };
        $("#refresh").show();
        loadDevice_parts(deviceId,params,function(data){
            if(data.result && data.result.length>0){
                partsTable1(data);
                renderPagination(data,changeTabTwo);
            }else{
              clearPagination();
              $("#logContent").empty();
              $("#logContent").append('<tr><td colspan="8"  align="center" lang="text:no_data"></td></tr>');
            }
            $("#refresh").hide();
            locale.render({element: "#init_body"});
          },this)
      }


    //第三个标签方法调用
    function changeTabThree(cursor, tabPage) {
      $("#changeTable").hide();
      $("#lubricationTable").hide();
      $("#checkTablepart").show();
      // loading();
      $("#refresh").show();
      var limit = $("#pageNumberSelect").find("option:selected").val();
      var params={
        // id:deviceId,
        cursor:cursor,
        limit:limit
      };
      tab=3;
      loadDevice_parts(deviceId,params,function(data){
          if(data.result && data.result.length>0){
              partsTable2(data);
              renderPagination(data,changeTabThree);
          }else{
            clearPagination();
            $("#checkTable").empty();
            $("#checkTable").append('<tr><td colspan="8"  align="center" lang="text:no_data"></td></tr>');
          }
          $("#refresh").hide();
          locale.render({element: "#init_body"});
        },this)

    }
        //更换部件信息回填
        function partsTable(result){
            $("#parts_modal").empty();
            var parts=result.result;
            for(var i=0;i<parts.length;i++){
                var per = parts[i]
                var partsMaintain = per.maintain;
                var cycle = "";
                var mtName = "";
                var operate_change=[];
                if(partsMaintain && partsMaintain.length>0){
                  for(var j=0;j<partsMaintain.length;j++){
                    var main=partsMaintain[j].mtType;
                    if(main == 3){
                        cycle =  partsMaintain[j].cycle;
                        var mtName = partsMaintain[j].mtName;
                        operate_change.push(mtName);
                    }
                  }
                }else{
                  cycle = "";
                  mtName = "";
              }
              var pTable =
              '<tr id=' + per.pid + '>'+
                '<td>'+(typeof(per.part_name) == 'undefined'?'':per.part_name)+'</td>'+
                '<td>'+(typeof(per.serial) == 'undefined'?'':per.serial)+'</td>'+
                '<td>'+ (typeof(per.model) == 'undefined'?'':per.model)+'</td>'+
                '<td>'+ (typeof(per.replace_recent) == 'undefined'?'':schneider.util.dateFormat(per.replace_recent, "yyyy-MM-dd")) +'</td>'+
                '<td>'+ (typeof(cycle) == 'undefined'?'':cycle) +'</td>'+
                '<td>'+  operate_change +'</td>'+
                '<td  style="cursor:pointer" onclick="changeList(\'' + per.pid + '\')">'+ (typeof(per.replace_count) == 'undefined'?'':per.replace_count) +'</td>'+
                '<td class="text-center">'+
                '<span class="glyphicon glyphicon-edit link-black" aria-hidden="true" id="changeModel" lang="title:change"  onclick="moreInfoParts1(\'' + per.pid + '\');" style=" cursor: pointer;margin:0px 10px;"></span>'+
                '</td>'+
              '</tr>';
            $("#parts_modal").append(pTable);
          }
        }
        //润滑信息回填
        function partsTable1(result){
            $("#logContent").empty();
            var parts=result.result;
            for(var i=0;i<parts.length;i++){
                  var per = parts[i];
                  var partsMaintain = per.maintain;
                  var cycle = "";
                  var mtName = "";
                  var operate_lub=[];
                  if(partsMaintain && partsMaintain.length>0){
                      for(var j=0;j<partsMaintain.length;j++){
                          var main=partsMaintain[j].mtType;
                          if(main == 1){
                              cycle =  partsMaintain[j].cycle;
                              var mtName = partsMaintain[j].mtName;
                              operate_lub.push(mtName);
                          }
                      }
                  }else{
                    cycle = "";
                    mtName = "";
                }
              var pTable =
              '<tr id=' + per.pid + '>'+
                '<td>'+(typeof(per.part_name) == 'undefined'?'':per.part_name)+'</td>'+
                '<td>'+(typeof(per.serial) == 'undefined'?'':per.serial)+'</td>'+
                '<td>'+ (typeof(per.model) == 'undefined'?'':per.model)+'</td>'+
                '<td>'+ (typeof(per.lub_recent) == 'undefined'?'':schneider.util.dateFormat(per.lub_recent, "yyyy-MM-dd")) +'</td>'+
                '<td>'+  (typeof(cycle) == 'undefined'?'':cycle)  +'</td>'+
                '<td>'+  operate_lub +'</td>'+
                '<td style="cursor:pointer" onclick="LubList(\'' + per.pid + '\')">'+ (typeof(per.lub_count) == 'undefined'?'':per.lub_count) +'</td>'+
                '<td class="text-center">'+
                '<span class="glyphicon glyphicon-edit link-black" aria-hidden="true"  onclick="InfoParts(\'' + per.pid + '\');" lang="title:lubricate"  style=" cursor: pointer;margin:0px 10px;"></span>'+
                '</td>'+
              '</tr>';
          $("#logContent").append(pTable);
    }
  }
  //检查信息回填
    function partsTable2(result){
        $("#checkTable").empty();
        var parts=result.result;
        for(var i=0;i<parts.length;i++){
            var per = parts[i]
            var partsMaintain = per.maintain;
            var cycle = "";
            var mtName = "";
            var operate_service=[];
            if(partsMaintain && partsMaintain.length>0){
                for(var j=0;j<partsMaintain.length;j++){
                    var main=partsMaintain[j].mtType;
                    if(main == 2){
                        cycle =  partsMaintain[j].cycle;
                        var mtName = partsMaintain[j].mtName;
                        operate_service.push(mtName);
                    }
                }
            }else{
                cycle = "";
                mtName = "";
            }
          var pTable =
          '<tr id=' + per.pid + '>'+
            '<td>'+(typeof(per.part_name) == 'undefined'?'':per.part_name)+'</td>'+
            '<td>'+(typeof(per.serial) == 'undefined'?'':per.serial)+'</td>'+
            '<td>'+ (typeof(per.model) == 'undefined'?'':per.model)+'</td>'+
            '<td>'+ (typeof(per.repair_recent) == 'undefined'?'':schneider.util.dateFormat(per.repair_recent, "yyyy-MM-dd")) +'</td>'+
            '<td>'+  (typeof(cycle) == 'undefined'?'':cycle)  +'</td>'+
            '<td>'+  operate_service +'</td>'+
            '<td style="cursor:pointer" onclick="serviceList(\'' + per.pid + '\');">'+ (typeof(per.repair_count) == 'undefined'?'':per.repair_count) +'</td>'+
            '<td class="text-center">'+
            '<span class="glyphicon glyphicon-edit link-black"  aria-hidden="true" lang="title:service"  onclick="moreInfoParts3(\'' + per.pid + '\');" style=" cursor: pointer;margin:0px 10px;"></span>'+
            '</td>'+
          '</tr>';
          $("#checkTable").append(pTable);
    }
  }
    // 更换记录模态框
      var tab_his=4;
      function changeList(Lid){
          $("#changeListModal").modal({show:true});
          $("#ch_list").show();
          $("#lub_list").hide();
          $("#ser_list").hide();
          var limit = $("#pageNumberSelect_history").find("option:selected").val();
          var params={
            // cursor: cursor,
            limit: limit,
            pid:Lid,
            mtType:3
          }
          tab_his=4;
          loadAllHistory(params,function(data){
            if(data.result && data.result.length>0){
                partsTable_changeList(data);
                renderPagination_his(data,changeList);
            }else{
              clearPagination_his();
              $("#parts_modal_list").empty();
              $("#parts_modal_list").append('<tr><td colspan="8"  align="center" lang="text:no_data"></td></tr>');
            }
            $("#refresh").hide();
            locale.render({element: "#init_body"});
          },this);
      }
      //更换记录模态框中的信息回填
      function partsTable_changeList(result){
          $("#parts_modal_list").empty();
          var parts=result.result;
          for(var i=0;i<parts.length;i++){
            var per = parts[i]
            var state=null;
            if (per.action == 3) {
                state = locale.get({lang: "installation"});
            } else if (per.action == 4) {
                state = locale.get({lang: "uninstall"});
            }
            var pTable =
            '<tr>'+
              '<td>'+(typeof(per.asset_name) == 'undefined'?'':per.asset_name)+'</td>'+
              '<td>'+(typeof(per.part_name) == 'undefined'?'':per.part_name)+'</td>'+
              '<td>'+ (typeof(per.current_serial) == 'undefined'?'':per.current_serial)+'</td>'+
              '<td>'+ (typeof(per.model) == 'undefined'?'':per.model)+'</td>'+
              '<td>'+ (typeof(per.update_time) == 'undefined'?'':schneider.util.dateFormat(per.update_time, "yyyy-MM-dd")) +'</td>'+
              '<td>'+ (typeof(per.operator) == 'undefined'?'':per.operator)+'</td>'+
              '<td>'+ (typeof(per.note) == 'undefined'?'':per.note)+'</td>'+
              '<td class="text-center">'+ (typeof(state) == 'undefined'?'':state)+'</td>'+
            '</tr>';
          $("#parts_modal_list").append(pTable);
        }
        permissionFilter_pageFunc();
        locale.render({element: "#init_body"});
      }


      // 润滑记录模态框
      function LubList(Lid){
          $("#changeListModal").modal({show:true});
          $("#lub_list").show();
          $("#ch_list").hide();
          $("#ser_list").hide();
          var limit = $("#pageNumberSelect").find("option:selected").val();
          var params={
            // cursor: cursor,
            limit: limit,
            pid:Lid,
            mtType:1
          }
          tab_his=5;
          loadAllHistory(params,function(data){
            if(data.result && data.result.length>0){
                partsTable_lubList(data);
                renderPagination_his(data,LubList);
            }else{
              clearPagination_his();
              $("#logContent_lub").empty();
              $("#logContent_lub").append('<tr><td colspan="7"  align="center" lang="text:no_data"></td></tr>');
            }
            $("#refresh").hide();
            locale.render({element: "#init_body"});
          },this);
      }
      //润滑记录模态框中的信息回填
      function partsTable_lubList(result){
          $("#logContent_lub").empty();
          var parts=result.result;
          for(var i=0;i<parts.length;i++){
              var per = parts[i]
              var pTable =
              '<tr>'+
                '<td>'+(typeof(per.asset_name) == 'undefined'?'':per.asset_name)+'</td>'+
                '<td>'+(typeof(per.part_name) == 'undefined'?'':per.part_name)+'</td>'+
                '<td>'+ (typeof(per.current_serial) == 'undefined'?'':per.current_serial)+'</td>'+
                '<td>'+ (typeof(per.model) == 'undefined'?'':per.model)+'</td>'+
                '<td>'+ (typeof(per.update_time) == 'undefined'?'':schneider.util.dateFormat(per.update_time, "yyyy-MM-dd")) +'</td>'+
                '<td>'+ (typeof(per.operator) == 'undefined'?'':per.operator)+'</td>'+
                '<td>'+ (typeof(per.note) == 'undefined'?'':per.note)+'</td>'+
              '</tr>';
              $("#logContent_lub").append(pTable);
        }
        permissionFilter_pageFunc();
        locale.render({element: "#init_body"});
      }
      //维修记录模态框
      function serviceList(Lid){
          $("#changeListModal").modal({show:true});
          $("#ser_list").show();
          $("#ch_list").hide();
          $("#lub_list").hide();
          var limit = $("#pageNumberSelect").find("option:selected").val();
          var params={
            // cursor: cursor,
            limit: limit,
            pid:Lid,
            mtType:2
          }
          tab_his=6;
          loadAllHistory(params,function(data){
            if(data.result && data.result.length>0){
                partsTable_serviceList(data);
                renderPagination_his(data,serviceList);
            }else{
              clearPagination_his();
              $("#service_list").empty();
              $("#service_list").append('<tr><td colspan="7"  align="center" lang="text:no_data"></td></tr>');
            }
            $("#refresh").hide();
            locale.render({element: "#init_body"});
          },this);
      }
      //维修记录模态框信息回填
      function partsTable_serviceList(result){
          $("#service_list").empty();
          var parts=result.result;
          for(var i=0;i<parts.length;i++){
            var per = parts[i]
            var pTable =
            '<tr>'+
              '<td>'+(typeof(per.asset_name) == 'undefined'?'':per.asset_name)+'</td>'+
              '<td>'+(typeof(per.part_name) == 'undefined'?'':per.part_name)+'</td>'+
              '<td>'+ (typeof(per.current_serial) == 'undefined'?'':per.current_serial)+'</td>'+
              '<td>'+ (typeof(per.model) == 'undefined'?'':per.model)+'</td>'+
              '<td>'+ (typeof(per.update_time) == 'undefined'?'':schneider.util.dateFormat(per.update_time, "yyyy-MM-dd")) +'</td>'+
              '<td>'+ (typeof(per.operator) == 'undefined'?'':per.operator)+'</td>'+
              '<td>'+ (typeof(per.note) == 'undefined'?'':per.note)+'</td>'+
            '</tr>';
            $("#service_list").append(pTable);
        }
        permissionFilter_pageFunc();
        locale.render({element: "#init_body"});
      }

    //跳转到指定页  回调函数
    function jumpTopage(cursor){
        if(tab ==1){
          changeTabOne(cursor,$("#pageNumberSelect").val());
        }else if(tab==2){
          changeTabTwo(cursor,$("#pageNumberSelect").val());
        }else if(tab==3){
          changeTabThree(cursor,$("#pageNumberSelect").val());
        }

    }
    //每页显示条目切换
    function changePageNumber(limit) {
        if(tab == 1){
          changeTabOne(0,limit);
        }else if(tab==2){
          changeTabTwo(0,limit);
        }else if(tab==3){
          changeTabThree(0,limit);
        }

    }
    //模态框分页
    function changePageNumber_his(limit) {
        if(tab_his==4){
          changeList(0,limit);
        }else if(tab_his==5){
          LubList(0,limit);
        }else if(tab_his==6){
          serviceList(0,limit);
        }

    }
        //更换部件操作按钮
        function moreInfoParts1(mId){
            $("#changeModal").modal({show: true});
            $("#factory_time").datepicker(pickerOption);
            $("#tempMid_ch").val(mId);
            $("#factory_time").val("");
            $("#serial_number1").val("");
            $("#type1").val("");
            $("#price").val("");
            $("#supplier").val("");
            $("#dec_ch").val("");
            var ids=[];
            ids.push(mId);
            var query={
                resourceIds:ids
            };
          getPartsInfoById(deviceId,query,function(data){
           var result=data.result[0];
           $("#serial_number_ch").val(result.serial);
           $("#component_name_ch").val(result.part_name);
           },this)
        }

        //润滑部件操作按钮
        function InfoParts(pId){
          $("#tempMid_m").val(pId);
          $("#lubricateModal").modal({show: true});
          $("#dec").val("");
          var ids=[];
          ids.push(pId);
          var query={
              resourceIds:ids
          };
        getPartsInfoById(deviceId,query,function(data){
         var result=data.result[0];
            $("#serial_number_1").val(result.serial);
         $("#component_name").val(result.part_name);
         $("#type").val(result.model);

         },this)
        }



        //检查部件操作按钮
        function moreInfoParts3(mId){
            $("#serviceModal").modal({show: true});
            $("#tempMid_de").val(mId);
            $("#dec1").val("");
            var ids=[];
            ids.push(mId);
            var query={
                resourceIds:ids
            };
          getPartsInfoById(deviceId,query,function(data){
           var result=data.result[0];
           $("#serial_number_se").val(result.serial);
           $("#component_name_se").val(result.part_name);
           $("#type_se").val(result.model);

           },this)
        }
        //点击更换部件模态框中的提交事件
        function moreInfoParts5(){
            var pId = $("#tempMid_ch").val();
            var lub_person=[];
            var lub = $("#inform_person_lub").find("option:selected").val();
            lub_person.push(lub);
            if ($('#form_id').validationEngine('validate')) {
              var serial = $("#serial_number1").val();
              var opr=$("#component_name_ch").val();
              if(serial != ''){
                var partsData={
                  pid:pId,
                  maintainerIds:lub_person,
                  part_name:opr,
                  change_type:3
                };
                var parts=[];
                parts.push(partsData);
              var params = {
                  parts: parts
              };
              var serial_number1 = $.trim($("#serial_number1").val());
              var endT = schneider.util.dateFormat(new Date().getTime(), "yyyy-MM-dd")
              if (serial_number1 !== "") {
                  partsData.serial = serial_number1;
              }
              var type1 = $.trim($("#type1").val());
              if (type1 !== "") {
                  partsData.model = type1;
              }
              var price = $.trim($("#price").val());
              if (price !== "") {
                  partsData.price = price;
              }
              var supplier = $.trim($("#supplier").val());
              if (supplier !== "") {
                  partsData.vendor_name = supplier;
              }
              var factory_time = $.trim($("#factory_time").val());
              if (factory_time !== "") {
                  partsData.factory_ts =  new Date(factory_time).getTime();
              }
              var dec_ch = $.trim($("#dec_ch").val());
              if (dec_ch !== "") {
                  partsData.note = dec_ch;
              }
              partsMaintain(deviceId,params,function(data){
                $("#" + pId).find("td").eq(2).html(serial_number1);
                $("#" + pId).find("td").eq(4).html(endT);
                var tip=$("#serial_number1").val();
                $("#serial_number_ch").val(tip);
                if(typeof(data.result)!="undefined") {
                    dialog.render({
                        lang:"submit_success",
                        close: function() {
                            dialog.close();
                        }
                    });
                }else {
                    dialog.render({
                        lang:"submit_failed",
                        close: function() {
                            dialog.close();
                        }
                    });
                }
               },this)
               $("#changePartsID").attr("data-dismiss","modal");
              }
            }else{
              $("#changePartsID").removeAttr("data-dismiss","modal");
            }
        }

        //点击润滑部件模态框中的提交事件
        function moreInfoParts2(){
          var pId = $("#tempMid_m").val();
          var change_person=[];
          var change = $("#inform_person").find("option:selected").val();
          change_person.push(change);
          var opr=$("#component_name").val();
          var partsData={
            pid:pId,
            maintainerIds:change_person,
            change_type:1
          };
          var parts=[];
          parts.push(partsData);
        var params = {
            parts: parts
        };
          var dec = $.trim($("#dec").val());
          if (dec !== "") {
              partsData.note = dec;
          }
          partsMaintain(deviceId,params,function(data){
            if(typeof(data.result)!="undefined") {
                dialog.render({
                    lang:"submit_success",
                    close: function() {
                        dialog.close();
                    }
                });
            }else {
                dialog.render({
                    lang:"submit_failed",
                    close: function() {
                        dialog.close();
                    }
                });
            }
           },this)
        }

        //点击检查部件模态框中的提交事件
        function moreInfoParts4(){
          var mId=$("#tempMid_de").val();
          var check_person=[];
          var check = $("#inform_person_check").find("option:selected").val();
          check_person.push(check);
        var partsData={
          pid:mId,
          maintainerIds:check_person,
          change_type:2
        };
        var parts=[];
        parts.push(partsData);
      var params = {
          parts: parts
      };
        var dec1 = $.trim($("#dec1").val());
        if (dec1 !== "") {
            partsData.note = dec1;
        }
        partsMaintain(deviceId,params,function(data){
          if(typeof(data.result)!="undefined") {
              dialog.render({
                  lang:"submit_success",
                  close: function() {
                      dialog.close();
                  }
              });
          }else {
              dialog.render({
                  lang:"submit_failed",
                  close: function() {
                      dialog.close();
                  }
              });
          }
         },this)
        }
        validator.render("#form_id", {
            promptPosition: "inline",
            scroll: false
        });
        $("#changePartsID").click(function (event){
           $('#form_id').validationEngine('validate');
        })
    //页面功能权限过滤
      function initparts(_id) {
        deviceId = _id;
        permissionFilter_pageFunc();
        require(['deviceService','siteService'], function (deviceService) {
          $("#page-footer").load("../admin/pagination.html",function(){
              showTabContent(1);
              getMaintainer();

          });
          $("#page-footer_list").load("../admin/pagination_history.html",function(){
          });
        });
        locale.render({element: "#init_body"});
    };


</script>
