<script type="text/javascript">
		require(['echarts'], function(cardingService) {
				init();
		});
	locale.render({element: "#init_body"});
	$('#smjcs').multiselect();
	 function end(){
        var mydate = new Date();
        var str = "" + mydate.getFullYear() + "-";
        str += (mydate.getMonth()+1) + "-";
        console.log(str);
        str += mydate.getDate();
        console.log(str);
        return str;
        }
        $("#endDate").val(end());
         function start() {
        var now = new Date();
        var date = new Date(now.getTime() -  24 * 3600 * 1000);
        var str = "" + date.getFullYear() + "-";
        str += (date.getMonth()+1) + "-";
        str += date.getDate();
        return str;
    }
        $("#startDate").val(start());

    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "H+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

		// 图表绘制
				function drawChart(id,option){

									require(
													[
														'echarts',
														'echarts/chart/line', // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
														'echarts/chart/bar',
														'echarts/chart/pie'
													],
													function (ec, theme) {
															//--- 折柱 ---
															var myChart = ec.init(document.getElementById(id), theme);
															//图表显示提示信息
															myChart.showLoading({
																	text: "图表数据正在努力加载...",
																	x: "center",
																	y: "center",
																	textStyle: {
																			color: "white",
																			fontSize: 14
																	},
																	effect: "spin"
															});

															myChart.setOption(option);
															myChart.hideLoading();
															chartIds[id] = myChart;
													}
										 );
									}

									function init(){
										var varIds = $("#smjcs").val();
								    console.log(varIds);
								    var deviceId = "57ab306f9e620b22b6747766";
								    var devices = [];
								    var device = {
								        "varIds": varIds,
								        "deviceId": deviceId
								    };
								    devices.push(device);
								    console.log(devices);
								    var startTime=$("#startDate").val();
								    var start_time = new Date(startTime).getTime()/1000;
								    console.log(start_time);
								    var endTime=$("#endDate").val();
								    var end_time = new Date(endTime).getTime()/1000;
								    console.log(end_time);
								    var limit =3;
								    var params= JSON.stringify({
								        "devices":devices
								    });
								    console.log(params);
								    var query= {
								        limit: limit,
								        start_time:start_time,
								        end_time:end_time,
								        verbose: "100"
								    };
										loadCardingData(params,query,function(data) {
											if(data.result == undefined || data.result.length == 0){
													$('#gzxl_footer').html('无数据');
											}else if(data.result[0].vars[0].values == undefined || data.result[0].vars[0].values.length == 0){
													$('#gzxl_footer').html('图表暂无数据');
											}else{
												var values = data.result[0].vars[0].values;
												var cx = [];
												var cy = [];
												for (var i = 0, len = values.length; i < len; i++) {
														var temp = values[i];
														function getLocalTime(nS) {
																return new Date(parseInt(nS) * 1000).Format("yyyy-MM-dd HH:mm:ss").substring(10,16);
														}
														cx[i] = getLocalTime(temp[0]);
														cy[i] = parseInt(temp[1]);
												}
												console.log(cx);
												console.log(cy);
											var 	workOption = {
														tooltip: {
																trigger: 'axis'
														},
														legend: {
																data: ['工作效率']
														},
														toolbox: {
																show: true,
																feature: {
																		magicType: {show: true, type: ['line', 'bar']},
																		restore: {show: true},
																		saveAsImage: {show: true}
																}
														},
														xAxis: {
																type: 'category',
																boundaryGap: false,
																data: cx
														},
														yAxis: {
																type: 'value',
																axisLabel: {
																		formatter: '{value} '
																}
														},
														series: [
																{
																		name: '工作效率',
																		type: 'line',
																		data: cy,
																		markPoint: {
																				data: [
																						{type: 'max', name: locale.get({lang:"maxValue"})},
																						{type: 'min', name: locale.get({lang:"minValue"})}
																				]
																		},
																		markLine: {
																				data: [
																						{type: 'average', name: locale.get({lang:"average"})}
																				]
																		}
																}
														]
												};

											var 	absorbOption = {
														tooltip: {
																trigger: 'axis'
														},
														legend: {
																data: ['吸棉压力']
														},
														toolbox: {
																show: true,
																feature: {
																		magicType: {show: true, type: ['line', 'bar']},
																		restore: {show: true},
																		saveAsImage: {show: true}
																}
														},
														xAxis: {
																type: 'category',
																boundaryGap: false,
																data: cx
														},
														yAxis: {
																type: 'value',
																axisLabel: {
																		formatter: '{value} '
																}
														},
														series: [
																{
																		name: '吸棉压力',
																		type: 'line',
																		data: cy,
																		markPoint: {
																				data: [
																						{type: 'max', name: locale.get({lang:"maxValue"})},
																						{type: 'min', name: locale.get({lang:"minValue"})}
																				]
																		},
																		markLine: {
																				data: [
																						{type: 'average', name: locale.get({lang:"average"})}
																				]
																		}
																}
														]
												};

											var 	hitOption = {
														tooltip: {
																trigger: 'axis'
														},
														legend: {
																data: ['打手速度']
														},
														toolbox: {
																show: true,
																feature: {
																		magicType: {show: true, type: ['line', 'bar']},
																		restore: {show: true},
																		saveAsImage: {show: true}
																}
														},
														xAxis: {
																type: 'category',
																boundaryGap: false,
																data: cx
														},
														yAxis: {
																type: 'value',
																axisLabel: {
																		formatter: '{value} '
																}
														},
														series: [
																{
																		name: '打手速度',
																		type: 'line',
																		data: cy,
																		markPoint: {
																				data: [
																						{type: 'max', name: locale.get({lang:"maxValue"})},
																						{type: 'min', name: locale.get({lang:"minValue"})}
																				]
																		},
																		markLine: {
																				data: [
																						{type: 'average', name: locale.get({lang:"average"})}
																				]
																		}
																}
														]
												};

												var catchOption = {
														tooltip: {
																trigger: 'axis'
														},
														legend: {
																data: ['抓臂速度']
														},
														toolbox: {
																show: true,
																feature: {
																		magicType: {show: true, type: ['line', 'bar']},
																		restore: {show: true},
																		saveAsImage: {show: true}
																}
														},
														xAxis: {
																type: 'category',
																boundaryGap: false,
																data: cx
														},
														yAxis: {
																type: 'value',
																axisLabel: {
																		formatter: '{value} '
																}
														},
														series: [
																{
																		name: '抓臂高度',
																		type: 'line',
																		data: cy,
																		markPoint: {
																				data: [
																						{type: 'max', name: locale.get({lang:"maxValue"})},
																						{type: 'min', name: locale.get({lang:"minValue"})}
																				]
																		},
																		markLine: {
																				data: [
																						{type: 'average', name: locale.get({lang:"average"})}
																				]
																		}
																}
														]
												};

											var 	walkOption = {
														tooltip: {
																trigger: 'axis'
														},
														legend: {
																data: ['行走速度']
														},
														toolbox: {
																show: true,
																feature: {
																		magicType: {show: true, type: ['line', 'bar']},
																		restore: {show: true},
																		saveAsImage: {show: true}
																}
														},
														xAxis: {
																type: 'category',
																boundaryGap: false,
																data: cx
														},
														yAxis: {
																type: 'value',
																axisLabel: {
																		formatter: '{value} '
																}
														},
														series: [
																{
																		name: '行走速度',
																		type: 'line',
																		data: cy,
																		markPoint: {
																				data: [
																						{type: 'max', name: locale.get({lang:"maxValue"})},
																						{type: 'min', name: locale.get({lang:"minValue"})}
																				]
																		},
																		markLine: {
																				data: [
																						{type: 'average', name: locale.get({lang:"average"})}
																				]
																		}
																}
														]
												};

											var 	heightOption = {
														tooltip: {
																trigger: 'axis'
														},
														legend: {
																data: ['塔身高度']
														},
														toolbox: {
																show: true,
																feature: {
																		magicType: {show: true, type: ['line', 'bar']},
																		restore: {show: true},
																		saveAsImage: {show: true}
																}
														},
														xAxis: {
																type: 'category',
																boundaryGap: false,
																data: cx
														},
														yAxis: {
																type: 'value',
																axisLabel: {
																		formatter: '{value} '
																}
														},
														series: [
																{
																		name: '塔身高度',
																		type: 'line',
																		data: cy,
																		markPoint: {
																				data: [
																						{type: 'max', name: locale.get({lang:"maxValue"})},
																						{type: 'min', name: locale.get({lang:"minValue"})}
																				]
																		},
																		markLine: {
																				data: [
																						{type: 'average', name: locale.get({lang:"average"})}
																				]
																		}
																}
														]
												};
												drawChart("gzxl-char1",workOption);
												// drawChart("cmyl-chart1",cottonOption);
											}
										},this);

									}



	function sureBtn(){
		var a=$('#smjcs').val();
		console.log(a);
		if(a==null){
			console.log("shi null")
			$("#allChars").empty();
				var xmylHtml='<div class="row">'+
                                '<div class="col-md-12">'+
                                   '<div class="box">'+
                                        '<div class="box-header with-border">'+
                                            '<span id="cltj_title_1"><h3 class="box-title" lang="text:work_efficiency">工作效率</h3></span>'+
                                            '<div class="box-tools pull-right">'+
                                                '<button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus"></i></button>'+
                                            '</div>'+
                                        '</div>'+
                                        '<div class="box-body">'+
                                            '<div id="gzxl-char2" class="col-md-12 col-xs-12" style="height:350px;width:98%;padding:1px"  align="left">'+

                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>';
                        $("#allChars").append(xmylHtml);
     require(
                [
                    'echarts',
                    'echarts/chart/line', // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
                    'echarts/chart/bar',
                    'echarts/chart/pie',
                ],
                function (ec) {
                    var gzxlChar2 = ec.init(document.getElementById("gzxl-char2"));
                    gzxlChar2.setOption(workOption);
                }
        );
		}else{
                        var c=a.length;
                        $("#allChars").empty();
                        var xmylHtml='<div class="row">'+
                            '<div class="col-md-6">'+
                               '<div class="box">'+
                                    '<div class="box-header with-border">'+
                                        '<span id="cltj_title_1"><h3 class="box-title" lang="text:work_efficiency">工作效率</h3></span>'+
                                        '<div class="box-tools pull-right">'+
                                            '<button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus"></i></button>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="box-body">'+
                                        '<div id="gzxl-char4" class="col-md-12 col-xs-12" style="height:220px;width:98%;padding:1px"  align="left">'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>';
        for(var i = 0;i <c;i++){
            var name = "";
            var id = "";
          if(a[i]==400050){
              name = "吸棉压力";
              id = "xmyl-char1"
          }else if(a[i]==400054){
              name = "打手转速";
              id = "dszs-char1"
          }else if(a[i]==400144){
              name = "抓臂高度";
              id = "zbgd-char1"
          }else if(a[i]==400192){
              name = "行走速度";
              id = "xzsd-char1"
          }else if(a[i]==400194){
              name = "塔身高度";
              id = "tsgd-char1"
          }
          xmylHtml += '<div class="col-md-6">'+
           '<div class="box">'+
                '<div class="box-header with-border">'+
                    '<span id="cltj_title_1"><h3 class="box-title">'+ name +'</h3></span>'+
                    '<div class="box-tools pull-right">'+
                        '<button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus"></i></button>'+
                    '</div>'+
                '</div>'+
                '<div class="box-body">'+
                    '<div id="'+ id +'" class="col-md-12 col-xs-12" style="height:220px;width:98%;padding:1px"  align="left">'+

                    '</div>'+
                '</div>'+
            '</div>'+
        '</div>';
        }
        xmylHtml +="</div>";
    $("#allChars").append(xmylHtml);
     require(
                [
                    'echarts',
                    'echarts/chart/line', // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
                    'echarts/chart/bar',
                    'echarts/chart/pie',
                ],
                function (ec) {
                    var gzxlChar4 = ec.init(document.getElementById("gzxl-char4"));
                    gzxlChar4.setOption(workOption);
                    var c=a.length;
                    for(var i = 0;i < c;i++){
                        if(a[i]==400050){
                            var xmylChar1 = ec.init(document.getElementById("xmyl-char1"));
                            xmylChar1.setOption(absorbOption);
                        }else if(a[i]==400054){
                            var dszsChar1 = ec.init(document.getElementById("dszs-char1"));
                            dszsChar1.setOption(hitOption);
                        }else if(a[i]==400144){
                            var zbgdChar1 = ec.init(document.getElementById("zbgd-char1"));
                            zbgdChar1.setOption(catchOption);
                        }else if(a[i]==400192){
                            var xzsdChar1 = ec.init(document.getElementById("xzsd-char1"));
                            xzsdChar1.setOption(walkOption);
                        }else if(a[i]==400194){
                            var tsgdChar1 = ec.init(document.getElementById("tsgd-char1"));
                            tsgdChar1.setOption(heightOption);
                        }
                    }

                }
            );
        }
    }

</script>
<!-- Main content -->
<section class="content-header">
    <h1 lang="text:carding_machine">
        梳棉机
        <small>Version 2.0</small>
    </h1>

    <ol class="breadcrumb">
        <li><a href="javascript:void(0)" onclick="click2url(1)"><i class="icon-home"></i> Home</a></li>
    </ol>
</section>
<section class="content" id="tcontent">
    <div class="row">
        <div class="from-group" role="toolbar">
            <div class="col-md-2">
                <select id="hmj" class="form-control " style="width: 70%" onchange="ShowDiv(parseInt(this.value), 'div');">
                    <option value="1" selected="" lang="text:carding_machine">梳棉机1</option>
                    <option value="2" lang="text:carding_machine">梳棉机2</option>
                    <option value="3" lang="text:carding_machine">梳棉机3</option>
                    <option value="4" lang="text:carding_machine">梳棉机4</option>
                    <option value="5" lang="text:carding_machine">梳棉机5</option>
                    <option value="6" lang="text:carding_machine">梳棉机6</option>
                </select>
            </div>
           <div class="col-md-2">
                <!--<label for="zmjcs" class="col-sm-4 control-label">参数选择</label>-->
                <select id="smjcs" style="width: 180px;" multiple="multiple">
	            			<option value="400050" selected="selected" lang="text:absorbing_cotton_pressure">吸棉压力</option>
                    <option value="400054" lang="text:fighter_speed">打手速度</option>
										<option value="400144" lang="text:picker_arms_height">抓臂高度</option>
                    <option value="400192" lang="text:walk_speed">行走速度</option>
                    <option value="400194" lang="text:tower_body_place">塔身位置</option>
	        </select>
            </div>

               <div class="col-md-3">
                <label for="startDate" class="col-sm-5 control-label" style="margin-top: 6px;" lang="text:start_date">开始日期</label>
                <div class="input-group date" >
                    <div class="input-group-addon">
                        <i class="icon-calendar"></i>
                    </div>
                    <input type="text"  id="startDate" data-provide="date-picker" class="form-control"  readonly="readonly"
                           onFocus="WdatePicker();">
                </div>

            </div>
            <div class="col-md-3">
                <label class="col-sm-5 control-label" style="margin-top:6px;" lang="text:end_date">截止日期</label>
                <div class="input-group date">
                    <div class="input-group-addon">
                        <i class="icon-calendar"></i>
                    </div>
                    <input type="text"  id="endDate" data-provide="date-picker" class="form-control"  readonly="readonly"  onFocus="WdatePicker();"/>
                </div>
            </div><!-- /.col-lg-6 -->
            <div class="col-md-2">
                <button type="button" id="sureBtn" class="btn btn-default pull-left"  style="margin: 0px 15px;" onClick="sureBtn();" lang="text:confirm">确定</button>
                <button type="button" class="btn btn-default pull-left" style="display: none" lang="text:export">导出</button>
            </div>
        </div>


        </div>

    <div id="allChars" style="margin-top: 20px;">
        <!--梳棉机1-->
        <div class="row" id="div1" style="display: block;">
            <div class="col-md-12">
               <div class="box">
                    <div class="box-header with-border">
                        <h3 class="box-title" lang="text:work_efficiency">工作效率</h3>
                        <div class="box-tools pull-right">
                            <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus"></i></button>
                            <!--button class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove"><i class="icon-times"></i></button-->
                        </div>
                    </div>
                    <div class="box-body">
                        <div id="gzxl-char1" class="col-md-12 col-xs-12" style="height:350px;width:98%;padding:1px"  align="left">

                        </div>
                    </div><!-- /.box-body -->
										<div class="box-footer">
                    		<span class="text-center text-info center-block"  id="gzxl_footer"></span>
                		</div>
                </div><!-- /.box -->
            </div>
        </div>
        <!--梳棉机2-->
        <div class="row" id="div2" style="display: none;">
            <div class="col-md-12">
               <div class="box">
                    <div class="box-header with-border">
                        <h3 class="box-title" lang="text:work_efficiency">工作效率2</h3>
                        <div class="box-tools pull-right">
                            <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus"></i></button>
                            <!--button class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove"><i class="icon-times"></i></button-->
                        </div>
                    </div>
                    <div class="box-body">
                        <div id="gzxl-char3" class="col-md-12 col-xs-12" style="height:350px;width:98%;padding:1px"  align="left">

                        </div>
                    </div><!-- /.box-body -->
                </div><!-- /.box -->
            </div>
        </div>
        <!--梳棉机3-->
        <div class="row" id="div3" style="display: none;">
            <div class="col-md-12">
               <div class="box">
                    <div class="box-header with-border">
                        <h3 class="box-title" lang="text:work_efficiency">工作效率3</h3>
                        <div class="box-tools pull-right">
                            <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus"></i></button>
                            <!--button class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove"><i class="icon-times"></i></button-->
                        </div>
                    </div>
                    <div class="box-body">
                        <div id="gzxl-char5" class="col-md-12 col-xs-12" style="height:350px;width:98%;padding:1px"  align="left">

                        </div>
                    </div><!-- /.box-body -->
                </div><!-- /.box -->
            </div>
        </div>
    </div>

</section>
